<!DOCTYPE html>
<html>
<head>
    <title>Three.js Generative Art</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <button id="regenerateButton">Regenerate Sculpture</button>
    <div>
        <label for="detailSlider">Detail:</label>
        <input type="range" id="detailSlider" min="8" max="64" value="32" step="4">
        <span id="detailValue">32</span>
    </div>
    <div id="container"></div>
    <script>
        // Get the container element
        const container = document.getElementById('container');
        const regenerateButton = document.getElementById('regenerateButton');
        const detailSlider = document.getElementById('detailSlider');
        const detailValue = document.getElementById('detailValue');

        let sculpture; // Make sculpture globally accessible

        // Scene
        const scene = new THREE.Scene();

        // Camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);

        // Renderer
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Window Resize Listener
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Generative Art Algorithm
        function generateSculpture(detail) {
            const baseGeometry = new THREE.SphereGeometry(1, detail, detail);
            const positions = baseGeometry.attributes.position;
            const vertex = new THREE.Vector3();
            const originalRadius = 1; // Assuming original radius of sphere is 1

            for (let i = 0; i < positions.count; i++) {
                vertex.fromBufferAttribute(positions, i);
                
                const displacementFactor = (Math.random() - 0.5) * 0.5;
                
                vertex.normalize().multiplyScalar(originalRadius + displacementFactor);
                
                positions.setXYZ(i, vertex.x, vertex.y, vertex.z);
            }
            positions.needsUpdate = true;

            const material = new THREE.MeshNormalMaterial();
            const newSculpture = new THREE.Mesh(baseGeometry, material);
            return newSculpture;
        }

        // Update Sculpture Function
        function updateSculpture() {
            if (sculpture) {
                scene.remove(sculpture);
                sculpture.geometry.dispose();
                sculpture.material.dispose();
            }
            const currentDetail = parseInt(detailSlider.value);
            sculpture = generateSculpture(currentDetail);
            scene.add(sculpture);
            detailValue.textContent = currentDetail;
        }

        // Event Listeners
        regenerateButton.addEventListener('click', updateSculpture);
        detailSlider.addEventListener('input', updateSculpture);

        // Lighting
        // Ambient Light
        const ambientLight = new THREE.AmbientLight(0x404040, 1); // soft white light
        scene.add(ambientLight);

        // Directional Light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1).normalize();
        scene.add(directionalLight);
        
        // Initial Sculpture generation
        updateSculpture();

        // Modified animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Rotate the sculpture
            if (sculpture) {
                sculpture.rotation.x += 0.005;
                sculpture.rotation.y += 0.005;
            }

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
